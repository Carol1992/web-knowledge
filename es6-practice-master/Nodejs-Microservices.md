# Node.js 微服务

### 微服务架构
1. 单块软件架构：大多数公司只有两个大的软件组件，即面向用户的网站和内部的管理系统
2. 与面向服务架构(SOA)的区别：微服务是细粒度的SOA组件，即某单个SOA组件可以被拆成多个微服务，而这些微服务通过分工协作，可以提供与原SOA组件相同级别的功能。
3. API聚合是一项用于将不同功能组合成一个接口的高级技术，微服务框架seneca就使用这个技术。

### 基于seneca和PM2构建node.js微服务
1. 每个node应用的根目录下面都有一个package.json文件，文件定义了这个项目所需要的各个模块，以及项目的配置信息，是一个自描述文件，文件中的scripts可以指定一些特定的命令来执行不同的动作。
2. 模块化的设计原则：SOLID,即单一职责原则、对扩展开发，对修改关闭原则、里氏替换原则、接口分离原则、依赖倒置原则。
3. seneca中所有的ORM原语都是以$结尾的。seneca基于以下操作，提供了简单的抽象数据层:
1) load:通过标识符读取实体；
2）save:创建实体或通过标识符更新实体；
3）list:列出满足查询条件的所有实体；
4）remove:删除指定标识符对应的实体。
4. PM2是一款可以为服务器实例带来负载均衡功能的生产级别的进程管理器，我们可以自由收缩node应用，是node.js的任务执行器。
5. seneca的模式匹配库patrun，使用最近匹配原则来处理调用，从以下两个角度来匹配最接近最具体的模式：最长的匹配链，模式中元素的顺序
6. seneca默认使用TCP协议。
7. seneca十分符合微服务的设计哲学，通过模式匹配，能够在对已有代码无影响的情况下扩展微服务已有的API，增加功能的同时不影响已有功能。

### 从单块软件到微服务
1. 使用微服务搭建金融系统的主要原则是：涉及金钱处理的部分不要过于微服务化，因为数据需要保持一致性。

### 构建一个商品管理微服务
1. 在微服务网络中为同一个接口交付新版本是相当容易的。我们甚至可以只在一个服务器上部署新版本，然后将部分流量引导到该服务器上，从而在不影响所有客户的情况下，验证新版本的正确性。
2. node-inspector是一个npm包，使得chrome可以调试node.js应用

### 安全性和可追溯性
1. 四大主要安全问题：注入攻击、跨站请求伪造、跨站脚本攻击、开放重定向
2. 是否对所有输入都进行了合法性检验和编码；是否对包括日志在内的所有输出都进行了编码；是否防御了跨站点请求伪造攻击；是否对所有存入数据库的用户身份信息进行加密或哈希？
3. seneca在日志方面做得非常好，它有许多可配置的选项，可以获取到所有运行时的信息。

### node.js微服务的测试和文档化
1. 通常正确的测试需要花费40%的开发时间，除了基本的人工测试，还有自动化测试：单元测试、端到端测试、集成测试
2. 单元测试也成为白盒测试，是一种只覆盖应用各个独立部分而不考虑其他模块集成的测试，在单元测试中，程序并不会与其他模块交互，是用来验证代码分支的。
3. 集成测试设计用来验证应用环境中各模块的之间集成的，验证的是业务单元。
4. 端到端测试不是测试应用的所有分支，而只测试设计好的用例。
5. 在一个健康的测试计划中，我们应该有大量的单元测试，适量的集成测试，和少量的端到端测试。
6. 在与测试相关的，node.js拥有非常强大的代码库，其中有两个尤其流行：Mocha 和 Chai
7. postman是用于测试API的软件；swagger是一个API管理工具， 采用swagger对API进行文档化

### 微服务的监控
1. keymetrics可以和PM2集成，把监控做到位

### 微服务的部署
1. 我在公司的测试环境部署过nodejs客户端的文件，没有部署过nodejs写的例如需要连接数据库的服务，不过可以试一下哦
2. 客户端部署步骤：安装node, npm, pm2. cd到根目录(含有package.json文件，我的应用用的是express框架，需要在测试服务器上安装)，执行npm install
3. 执行pm2 start app.js
